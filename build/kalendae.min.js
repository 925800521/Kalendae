/********************************************************************
 *	Kalendae, a framework agnostic javascript date picker           *
 *	Copyright(c) 2012 Jarvis Badgley (chipersoft@gmail.com)         *
 *	http://github.com/ChiperSoft/Kalendae                           *
 *	Version 0.1                                                     *
 ********************************************************************/

(function(){var j=window.Kalendae=function(a){var a=this.settings=e.merge(this.defaults,a),b=this.container=e.make("div",{"class":this.classes.container}),d=this.calendars=[],f=moment().day(a.weekStart),p=[],g,n,j;g=[];var v;n=0;var o=this.settings.months;for(n=7;n--;)p.push(f.format("ddd").substr(0,a.columnHeaderLength)),f.add("days",1);MinPubSub(this);if("object"===typeof a.subscribe)for(n in a.subscribe)a.subscribe.hasOwnProperty(n)&&this.subscribe(n,a.subscribe[n]);this.selected=[];a.selected&&
this.setSelected(a.selected,!1);this.viewStartDate=(a.viewStartDate?moment(a.viewStartDate,a.format):0<this.selected.length?moment(this.selected[0]):moment()).date(1);if("function"===typeof a.blackout)this.blackout=a.blackout;else if(a.blackout){var l=this.parseDates(a.blackout);this.blackout=function(a){a=moment(a).hours(0).minutes(0).seconds(0).valueOf();if(1>a||!this.selected||1>this.selected.length)return!1;for(var b=l.length;b--;)if(l[b].valueOf()===a)return!0;return!1}}else this.blackout=function(){return!1};
for(o=Math.max(this.settings.months,1);o--;){b.appendChild(g=e.make("div",{"class":this.classes.calendar}));g.setAttribute("data-cal-index",o);1<this.settings.months&&(o==Math.max(this.settings.months-1,1)?e.addClassName(g,this.classes.monthFirst):0===o?e.addClassName(g,this.classes.monthLast):e.addClassName(g,this.classes.monthMiddle));g.appendChild(n=e.make("div",{"class":this.classes.title}));n.appendChild(e.make("a",{"class":this.classes.previous}));n.appendChild(e.make("a",{"class":this.classes.next}));
n.appendChild(f=e.make("span",{"class":this.classes.caption}));g.appendChild(j=e.make("div",{"class":this.classes.header}));n=0;do j.appendChild(v=e.make("span")),v.innerHTML=p[n];while(7>++n);g.appendChild(j=e.make("div",{"class":this.classes.days}));n=0;for(g=[];42>n++;)j.appendChild(v=e.make("span")),g.push(v);d.push({caption:f,days:g});o&&b.appendChild(e.make("div",{"class":this.classes.monthSeparator}))}this.draw();var k=this;e.addEvent(b,"click",function(a,b){var d;if(e.hasClassName(b,k.classes.next))return!1!==
k.publish("view-changed",k,["next"])&&(k.viewStartDate.add("months",1),k.draw()),a.preventDefault(),!0;if(e.hasClassName(b,k.classes.previous))return!1!==k.publish("view-changed",k,["previous"])&&(k.viewStartDate.subtract("months",1),k.draw()),a.preventDefault(),!0;if(e.hasClassName(b.parentNode,k.classes.days)&&e.hasClassName(b,k.classes.dayActive)&&(d=b.getAttribute("data-date"))){d=moment(d,k.settings.dayAttributeFormat);if(!1!==k.publish("date-clicked",k,[d]))switch(k.settings.mode){case "multiple":k.addSelected(d)||
k.removeSelected(d);break;case "range":k.addSelected(d);break;default:k.addSelected(d)}a.preventDefault();return!0}});(a.attachTo=e.$(a.attachTo))&&a.attachTo.appendChild(b)};j.prototype.defaults={attachTo:null,months:1,weekStart:0,direction:"any",viewStartDate:null,blackout:null,selected:null,mode:"single",format:null,subscribe:null,columnHeaderLength:2,titleFormat:"MMMM, YYYY",dayNumberFormat:"D",dayAttributeFormat:"YYYY-MM-DD",parseSplitDelimiter:/,\s*|\s*-\s*/,rangeDelimiter:" - ",multipleDelimiter:", "};
j.prototype.classes={container:"kalendae",calendar:"k-calendar",monthFirst:"k-first-month",monthMiddle:"k-middle-month",monthLast:"k-last-month",title:"k-title",previous:"k-previous",next:"k-next",caption:"k-caption",header:"k-header",days:"k-days",dayOutOfMonth:"k-out-of-month",dayActive:"k-active",daySelected:"k-selected",dayInRange:"k-range",dayToday:"k-today",monthSeparator:"k-separator"};j.prototype.parseDates=function(a){var b=[];"string"===typeof a?a=a.split(this.settings.parseSplitDelimiter):
unit.isArray(a)||(a=[sel_in]);c=a.length;i=0;do b.push(moment(a[i]).hours(0).minutes(0).seconds(0));while(++i<c);return b};j.prototype.getSelectedAsDates=function(){for(var a=[],b=0,d=this.selected.length;b<d;b++)a.push(this.selected[b]["native"]());return a};j.prototype.getSelectedAsText=function(a){for(var b=[],d=0,f=this.selected.length;d<f;d++)b.push(this.selected[d].format(a||this.settings.format||"YYYY-MM-DD"));return b};j.prototype.getSelectedRaw=function(){for(var a=[],b=0,d=this.selected.length;b<
d;b++)a.push(moment(this.selected[b]));return a};j.prototype.getSelected=function(a){a=this.getSelectedAsText(a);switch(this.settings.mode){case "range":return a.splice(2),a.join(this.settings.rangeDelimiter);case "multiple":return a.join(this.settings.multipleDelimiter);default:return a[0]}};j.prototype.isSelected=function(a){a=moment(a).hours(0).minutes(0).seconds(0).valueOf();if(1>a||!this.selected||1>this.selected.length)return!1;switch(this.settings.mode){case "range":var b=this.selected[0]?
this.selected[0].valueOf():0,d=this.selected[1]?this.selected[1].valueOf():0;if(b===a||d===a)return 1;if(!b||!d)return 0;if(a>b&&a<d||b<d&&a<b&&a>d)return-1;break;case "multiple":for(b=this.selected.length;b--;)if(this.selected[b].valueOf()===a)return!0;break;default:return this.selected[0]&&this.selected[0].valueOf()===a}return!1};j.prototype.setSelected=function(a,b){this.selected=this.parseDates(a);this.selected.sort(function(a,b){return a.valueOf()-b.valueOf()});this.publish("change",this);!1!==
b&&this.draw()};j.prototype.addSelected=function(a,b){a=moment(a).hours(0).minutes(0).seconds(0);switch(this.settings.mode){case "multiple":if(this.isSelected(a))return!1;this.selected.push(a);break;case "range":1!==this.selected.length?this.selected=[a]:a.valueOf()>this.selected[0].valueOf()?this.selected[1]=a:this.selected=[a,this.selected[0]];break;default:this.selected=[a]}this.selected.sort(function(a,b){return a.valueOf()-b.valueOf()});this.publish("change",this);!1!==b&&this.draw();return!0};
j.prototype.removeSelected=function(a,b){for(var a=moment(a).hours(0).minutes(0).seconds(0).valueOf(),d=this.selected.length;d--;)if(this.selected[d].valueOf()===a)return this.selected.splice(d,1),this.publish("change",this),!1!==b&&this.draw(),!0;return!1};j.prototype.draw=function(){var a=moment(this.viewStartDate),b,d=moment().hours(0).minutes(0).seconds(0),f,p,g,n=0,e,j=0,o;e=this.calendars.length;do{b=moment(a).date(1).day(this.settings.weekStart);f=this.calendars[n];f.caption.innerHTML=a.format(this.settings.titleFormat);
j=0;do p=f.days[j],g=[],b.month()!=a.month()?g.push(this.classes.dayOutOfMonth):this.blackout(b)||g.push(this.classes.dayActive),(o=this.isSelected(b))&&g.push({"-1":this.classes.dayInRange,1:this.classes.daySelected,"true":this.classes.daySelected}[o]),0===Math.floor(d.diff(b,"days",!0))&&g.push(this.classes.dayToday),p.innerHTML=b.format(this.settings.dayNumberFormat),p.className=g.join(" "),p.setAttribute("data-date",b.format(this.settings.dayAttributeFormat)),b.add("days",1);while(42>++j);a.add("months",
1)}while(++n<e)};var e={isIE:/msie/.test(navigator.userAgent.toLowerCase()),$:function(a){return"string"==typeof a?document.getElementById(a):a},make:function(a,b){var d,f=document.createElement(a);if(b)for(d in b)b.hasOwnProperty(d)&&f.setAttribute(d,b[d]);return f},isVisible:function(a){return 0<a.offsetWidth||0<a.offsetHeight},addEvent:function(a,b,d){var f=function(b){b=b||window.event;return d.apply(a,[b,b.target||b.srcElement])};a.attachEvent?a.attachEvent("on"+b,f):a.addEventListener(b,f,!1);
return f},removeEvent:function(a,b,d){a.detachEvent?a.detachEvent("on"+b,d):a.removeEventListener(b,d,!1)},hasClassName:function(a,b){if(!(a=e.$(a)))return!1;var d=a.className;return 0<d.length&&(d==b||RegExp("(^|\\s)"+b+"(\\s|$)").test(d))},addClassName:function(a,b){if((a=e.$(a))&&!e.hasClassName(a,b))a.className+=(a.className?" ":"")+b},removeClassName:function(a,b){if(a=e.$(a))a.className=e.trimString(a.className.replace(RegExp("(^|\\s+)"+b+"(\\s+|$)")," "))},getTop:function(a,b){var d=a.offsetTop;
if(!b)for(;a=a.offsetParent;)d+=a.offsetTop;return d},getHeight:function(a){return a.offsetHeight||a.scrollHeight},getWidth:function(a){return a.offsetWidth||a.scrollWidth},trimString:function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},merge:function(){for(var a=!0===arguments[0],b={},d=a?1:0;d<arguments.length;d++){var f=b,e=arguments[d];if("object"===typeof e){var g=void 0;for(g in e)e.hasOwnProperty(g)&&(a&&"object"===typeof f[g]&&"object"===typeof e[g]?_update(f[g],e[g]):f[g]=e[g])}}return b},
isArray:function(a){return!(!a||!a.length||0===a.length||"object"!==typeof a||!a.constructor||a.nodeType||a.item)}};MinPubSub=function(a){a||(a=this);var b=a.c_||{};a.publish=function(a,f,e){for(var g=(a=b[a])?a.length:0,n;g--;)if(n=a[g].apply(f,e||[]),"boolean"===typeof n)return n};a.subscribe=function(a,f,e){b[a]||(b[a]=[]);e?b[a].push(f):b[a].unshift(f);return[a,f]};a.unsubscribe=function(a){for(var f=b[a[0]],a=a[1],e=f?f.length:0;e--;)f[e]===a&&f.splice(e,1)}};(function(a,b){function d(a){this._d=
a}function f(a,b){for(var s=a+"";s.length<b;)s="0"+s;return s}function e(b,m,s,d){var f="string"===typeof m,h=f?{}:m;f&&d&&(h[m]=d);m=(h.ms||h.milliseconds||0)+1E3*(h.s||h.seconds||0)+6E4*(h.m||h.minutes||0)+36E5*(h.h||h.hours||0);d=(h.d||h.days||0)+7*(h.w||h.weeks||0);h=(h.M||h.months||0)+12*(h.y||h.years||0);m&&b.setTime(+b+m*s);d&&b.setDate(b.getDate()+d*s);h&&(m=b.getDate(),b.setDate(1),b.setMonth(b.getMonth()+h*s),b.setDate(Math.min((new a(b.getFullYear(),b.getMonth()+1,0)).getDate(),m)));return b}
function g(b){return new a(b[0],b[1]||0,b[2]||1,b[3]||0,b[4]||0,b[5]||0,b[6]||0)}function n(b,m){function s(m){var d;switch(m){case "M":return g+1;case "Mo":return g+1+u(g+1);case "MM":return f(g+1,2);case "MMM":return l.monthsShort[g];case "MMMM":return l.months[g];case "D":return h;case "Do":return h+u(h);case "DD":return f(h,2);case "DDD":return m=new a(k,g,h),d=new a(k,0,1),~~((m-d)/864E5+1.5);case "DDDo":return m=s("DDD"),m+u(m);case "DDDD":return f(s("DDD"),3);case "d":return t;case "do":return t+
u(t);case "ddd":return l.weekdaysShort[t];case "dddd":return l.weekdays[t];case "w":return m=new a(k,g,h-t+5),d=new a(m.getFullYear(),0,4),~~((m-d)/864E5/7+1.5);case "wo":return m=s("w"),m+u(m);case "ww":return f(s("w"),2);case "YY":return f(k%100,2);case "YYYY":return k;case "a":return 11<j?p.pm:p.am;case "A":return 11<j?p.PM:p.AM;case "H":return j;case "HH":return f(j,2);case "h":return j%12||12;case "hh":return f(j%12||12,2);case "m":return o;case "mm":return f(o,2);case "s":return r;case "ss":return f(r,
2);case "zz":case "z":return(b.toString().match(C)||[""])[0].replace(D,"");case "Z":return(0<q?"+":"-")+f(~~(Math.abs(q)/60),2)+":"+f(~~(Math.abs(q)%60),2);case "ZZ":return(0<q?"+":"-")+f(~~(10*Math.abs(q)/6),4);case "L":case "LL":case "LLL":case "LLLL":case "LT":return n(b,l.longDateFormat[m]);default:return m.replace(/(^\[)|(\\)|\]$/g,"")}}var e=new d(b),g=e.month(),h=e.date(),k=e.year(),t=e.day(),j=e.hours(),o=e.minutes(),r=e.seconds(),q=e.zone(),u=l.ordinal,p=l.meridiem;return m.replace(E,s)}
function j(b,m){var d=[0,0,1,0,0,0,0],e=0,f=0,h=!1,k=b.match(y),n=m.match(F),o,p;for(o=0;o<n.length;o++){var r=k[o],q=void 0;switch(n[o]){case "M":case "MM":d[1]=~~r-1;break;case "MMM":case "MMMM":for(q=0;12>q;q++)if(l.monthsParse[q].test(r)){d[1]=q;break}break;case "D":case "DD":case "DDD":case "DDDD":d[2]=~~r;break;case "YY":r=~~r;d[0]=r+(70<r?1900:2E3);break;case "YYYY":d[0]=~~Math.abs(r);break;case "a":case "A":p="pm"===r.toLowerCase();break;case "H":case "HH":case "h":case "hh":d[3]=~~r;break;
case "m":case "mm":d[4]=~~r;break;case "s":case "ss":d[5]=~~r;break;case "Z":case "ZZ":h=!0,q=r.match(G),q[1]&&(e=~~q[1]),q[2]&&(f=~~q[2]),"-"===q[0]&&(e=-e,f=-f)}}p&&12>d[3]&&(d[3]+=12);!1===p&&12===d[3]&&(d[3]=0);d[3]+=e;d[4]+=f;return h?new a(a.UTC.apply({},d)):g(d)}function v(a,b,d){var e=l.relativeTime[a];return"function"===typeof e?e(b||1,!!d,a):e.replace(/%d/i,b||1)}function o(a,b){l.fn[a]=function(a){return null!=a?(this._d["set"+b](a),this):this._d["get"+b]()}}var l,k=Math.round,x={},A="undefined"!==
typeof module,B="months,monthsShort,monthsParse,weekdays,weekdaysShort,longDateFormat,calendar,relativeTime,ordinal,meridiem".split(","),w,E=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|dddd?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|zz?|ZZ?|LT|LL?L?L?)/g,D=/[^A-Z]/g,C=/\([A-Za-z ]+\)|:[0-9]{2} [A-Z]{3} /g,F=/(\\)?(MM?M?M?|dd?d?d|DD?D?D?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|ZZ?|T)/g,y=/(\\)?([0-9]+|([a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+|([\+\-]\d\d:?\d\d))/gi,G=/([\+\-]|\d\d)/gi,z="Month,Date,Hours,Minutes,Seconds,Milliseconds".split(",");
l=function(e,m){if(null===e)return null;var f;if(e&&e._d instanceof a)f=new a(+e._d);else if(m)if("[object Array]"===Object.prototype.toString.call(m)){var k=e.match(y),l=99,h,o,t;for(h=0;h<m.length;h++){o=j(e,m[h]);t=k;for(var p=n(o,m[h]).match(y),v=Math.min(t.length,p.length),r=Math.abs(t.length-p.length),q=0,u=void 0,u=0;u<v;u++)~~t[u]!==~~p[u]&&q++;t=q+r;t<l&&(l=t,f=o)}}else f=j(e,m);else f=e===b?new a:e instanceof a?e:"[object Array]"===Object.prototype.toString.call(e)?g(e):new a(e);return new d(f)};
l.version="1.3.0";l.lang=function(a,b){var d,e;e=[];if(b){for(d=0;12>d;d++)e[d]=RegExp("^"+b.months[d]+"|^"+b.monthsShort[d].replace(".",""),"i");b.monthsParse=b.monthsParse||e;x[a]=b}if(x[a])for(d=0;d<B.length;d++)e=B[d],l[e]=x[a][e]||l[e];else A&&(d=require("./lang/"+a),l.lang(a,d))};l.lang("en",{months:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),monthsShort:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),weekdays:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),
weekdaysShort:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:{AM:"AM",am:"am",PM:"PM",pm:"pm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",
M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(a){var b=a%10;return 1===~~(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th"}});l.fn=d.prototype={clone:function(){return l(this)},valueOf:function(){return+this._d},"native":function(){return this._d},toString:function(){return this._d.toString()},toDate:function(){return this._d},format:function(a){return n(this._d,a)},add:function(a,b){this._d=e(this._d,a,1,b);return this},subtract:function(a,b){this._d=e(this._d,a,-1,b);
return this},diff:function(a,b,d){var e=l(a),a=this._d-e._d,f=this.year()-e.year(),h=this.month()-e.month(),e=this.day()-e.day(),b="months"===b?12*f+h+e/30:"years"===b?f+h/12:"seconds"===b?a/1E3:"minutes"===b?a/6E4:"hours"===b?a/36E5:"days"===b?a/864E5:"weeks"===b?a/6048E5:"days"===b?a/3600:a;return d?b:k(b)},from:function(a,b){var d=this.diff(a),e=l.relativeTime,f;f=k(Math.abs(d)/1E3);var h=k(f/60),g=k(h/60),j=k(g/24),n=k(j/365);f=45>f&&["s",f]||1===h&&["m"]||45>h&&["mm",h]||1===g&&["h"]||22>g&&
["hh",g]||1===j&&["d"]||25>=j&&["dd",j]||45>=j&&["M"]||345>j&&["MM",k(j/30)]||1===n&&["y"]||["yy",n];f[2]=b;f=v.apply({},f);return b?f:(0>=d?e.past:e.future).replace(/%s/i,f)},fromNow:function(a){return this.from(l(),a)},calendar:function(){var a=l(),a=this.diff(l([a.year(),a.month(),a.date()]),"days",!0),b=l.calendar,d=b.sameElse,a=-6>a?d:-1>a?b.lastWeek:0>a?b.lastDay:1>a?b.sameDay:2>a?b.nextDay:7>a?b.nextWeek:d;return this.format("function"===typeof a?a.apply(this):a)},isLeapYear:function(){var a=
this.year();return 0===a%4&&0!==a%100||0===a%400},isDST:function(){return this.zone()!==l([this.year()]).zone()},day:function(a){var b=this._d.getDay();return null==a?b:this.add({d:a-b})}};for(w=0;w<z.length;w++)o(z[w].toLowerCase(),z[w]);o("year","FullYear");l.fn.zone=function(){return this._d.getTimezoneOffset()};A&&(module.exports=l);"undefined"!==typeof window&&(window.moment=l)})(Date)})();
