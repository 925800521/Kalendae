/********************************************************************
 *	Kalendae, a framework agnostic javascript date picker           *
 *	Copyright(c) 2013 Jarvis Badgley (chipersoft@gmail.com)         *
 *	http://github.com/ChiperSoft/Kalendae                           *
 *	Version 0.4.2                                                   *
 ********************************************************************/

(function(fa){var v,l,p=function(a,b){if("function"===typeof document.addEventListener||d.isIE8()){var c=!1;try{c=a instanceof Element}catch(n){c=!!a&&1===c.nodeType}c||"string"===typeof a||(b=a);var e=this,f=e.classes,h=e.settings=d.merge(e.defaults,{attachTo:a},b||{}),c=e.container=d.make("div",{"class":f.container}),p=e.calendars=[],q=l().day(h.weekStart),t,u=[],m,r,B,v;m=[];var C;r=0;t=h.months;d.isIE8()&&d.addClassName(c,"ie8");for(r=7;r--;)u.push(q.format(h.columnHeaderFormat)),q.add("days",
1);E(e);if("object"===typeof h.subscribe)for(r in h.subscribe)h.subscribe.hasOwnProperty(r)&&e.subscribe(r,h.subscribe[r]);e._sel=[];h.selected&&e.setSelected(h.selected,!1);t=h.viewStartDate?l(h.viewStartDate,h.format):0<e._sel.length?l(e._sel[0]):l();e.viewStartDate=t.date(1);(t={past:h.months-1,"today-past":h.months-1,any:2<h.months?Math.floor(h.months/2):0,"today-future":0,future:0}[this.settings.direction])&&l().month()==l(e.viewStartDate).month()&&(e.viewStartDate=l(e.viewStartDate).subtract({M:t}).date(1));
if("function"===typeof h.blackout)e.blackout=h.blackout;else if(h.blackout){var y=D(h.blackout,h.parseSplitDelimiter,h.format);e.blackout=function(a){a=l(a).yearDay();if(1>a||!e._sel)return!1;for(var c=y.length;c--;)if(y[c].yearDay()===a)return!0;return!1}}else e.blackout=function(){return!1};e.direction=e.directions[h.direction]?e.directions[h.direction]:e.directions.any;for(t=Math.max(h.months,1);t--;){m=d.make("div",{"class":f.calendar},c);m.setAttribute("data-cal-index",t);1<h.months&&(t==Math.max(h.months-
1,1)?d.addClassName(m,f.monthFirst):0===t?d.addClassName(m,f.monthLast):d.addClassName(m,f.monthMiddle));r=d.make("div",{"class":f.title},m);h.useYearNav||d.addClassName(r,f.disableYearNav);d.make("a",{"class":f.previousYear},r);d.make("a",{"class":f.previousMonth},r);d.make("a",{"class":f.nextYear},r);d.make("a",{"class":f.nextMonth},r);q=d.make("span",{"class":f.caption},r);B=d.make("div",{"class":f.header},m);r=0;do C=d.make("span",{},B),C.innerHTML=u[r];while(7>++r);B=d.make("div",{"class":f.days},
m);r=0;m=[];do"week"==h.mode?(0===r%7&&(v=d.make("div",{"class":f.week+" clearfix"},B),m.push(v)),d.make("span",{},v)):m.push(d.make("span",{},B));while(42>++r);p.push({caption:q,days:m});t&&d.make("div",{"class":f.monthSeparator},c)}e.draw();d.addEvent(c,"mousedown",function(a,c){var b;if(d.hasClassName(c,f.nextMonth))e.disableNext||!1===e.publish("view-changed",e,["next-month"])||(e.viewStartDate.add("months",1),e.draw());else if(d.hasClassName(c,f.previousMonth))e.disablePreviousMonth||!1===e.publish("view-changed",
e,["previous-month"])||(e.viewStartDate.subtract("months",1),e.draw());else if(d.hasClassName(c,f.nextYear))e.disableNext||!1===e.publish("view-changed",e,["next-year"])||(e.viewStartDate.add("years",1),e.draw());else if(d.hasClassName(c,f.previousYear))e.disablePreviousMonth||!1===e.publish("view-changed",e,["previous-year"])||(e.viewStartDate.subtract("years",1),e.draw());else if((d.hasClassName(c.parentNode,f.days)||d.hasClassName(c.parentNode,f.week))&&d.hasClassName(c,f.dayActive)&&(b=c.getAttribute("data-date"))){if(b=
l(b,h.dayAttributeFormat).hours(12),!1!==e.publish("date-clicked",e,[b]))switch(h.mode){case "multiple":e.addSelected(b)||e.removeSelected(b);break;case "range":e.addSelected(b);break;case "week":e.weekSelected(b);break;default:e.addSelected(b)}}else d.hasClassName(c.parentNode,f.week)&&(b=c.getAttribute("data-date"))&&(b=l(b,h.dayAttributeFormat).hours(12),!1!==e.publish("date-clicked",e,[b])&&"week"==h.mode&&e.weekSelected(b));return!1});(h.attachTo=d.$(h.attachTo))&&h.attachTo.appendChild(c)}};
p.prototype={defaults:{attachTo:null,months:1,weekStart:0,direction:"any",directionScrolling:!0,viewStartDate:null,blackout:null,selected:null,mode:"single",dayOutOfMonthClickable:!1,format:null,subscribe:null,columnHeaderFormat:"dd",titleFormat:"MMMM, YYYY",dayNumberFormat:"D",dayAttributeFormat:"YYYY-MM-DD",parseSplitDelimiter:/,\s*|\s+-\s+/,rangeDelimiter:" - ",multipleDelimiter:", ",useYearNav:!0,dateClassMap:{}},classes:{container:"kalendae",calendar:"k-calendar",monthFirst:"k-first-month",monthMiddle:"k-middle-month",
monthLast:"k-last-month",title:"k-title",previousMonth:"k-btn-previous-month",nextMonth:"k-btn-next-month",previousYear:"k-btn-previous-year",nextYear:"k-btn-next-year",caption:"k-caption",header:"k-header",days:"k-days",week:"k-week",dayOutOfMonth:"k-out-of-month",dayInMonth:"k-in-month",dayActive:"k-active",daySelected:"k-selected",dayInRange:"k-range",dayToday:"k-today",monthSeparator:"k-separator",disablePreviousMonth:"k-disable-previous-month-btn",disableNextMonth:"k-disable-next-month-btn",
disablePreviousYear:"k-disable-previous-year-btn",disableNextYear:"k-disable-next-year-btn",disableYearNav:"k-disable-year-nav"},disablePreviousMonth:!1,disableNextMonth:!1,disablePreviousYear:!1,disableNextYear:!1,directions:{past:function(a){return l(a).yearDay()>=v.yearDay()},"today-past":function(a){return l(a).yearDay()>v.yearDay()},any:function(a){return!1},"today-future":function(a){return l(a).yearDay()<v.yearDay()},future:function(a){return l(a).yearDay()<=v.yearDay()}},getSelectedAsDates:function(){for(var a=
[],b=0,c=this._sel.length;b<c;b++)a.push(this._sel[b].toDate());return a},getSelectedAsText:function(a){for(var b=[],c=0,d=this._sel.length;c<d;c++)b.push(this._sel[c].format(a||this.settings.format||"YYYY-MM-DD"));return b},getSelectedRaw:function(){for(var a=[],b=0,c=this._sel.length;b<c;b++)a.push(l(this._sel[b]));return a},getSelected:function(a){a=this.getSelectedAsText(a);switch(this.settings.mode){case "week":case "range":return a.splice(2),a.join(this.settings.rangeDelimiter);case "multiple":return a.join(this.settings.multipleDelimiter);
default:return a[0]||null}},isSelected:function(a){a=l(a).yearDay();if(1>a||!this._sel||1>this._sel.length)return!1;switch(this.settings.mode){case "week":case "range":var b=this._sel[0]?this._sel[0].yearDay():0,c=this._sel[1]?this._sel[1].yearDay():0;return b===a||c===a?1:b&&c?a>b&&a<c||b<c&&a<b&&a>c?-1:!1:0;case "multiple":for(b=this._sel.length;b--;)if(this._sel[b].yearDay()===a)return!0;return!1;default:return this._sel[0]&&this._sel[0].yearDay()===a}},setSelected:function(a,b){var c,d=D(a,this.settings.parseSplitDelimiter,
this.settings.format),e=D(this.getSelected(),this.settings.parseSplitDelimiter,this.settings.format);for(c=e.length;c--;)this.removeSelected(e[c],!1);for(c=d.length;c--;)this.addSelected(d[c],!1);!1!==b&&(d[0]&&(this.viewStartDate=l(d[0],this.settings.format)),this.draw())},addSelected:function(a,b){a=l(a,this.settings.format).hours(12);this.settings.dayOutOfMonthClickable&&"range"!==this.settings.mode&&this.makeSelectedDateVisible(a);switch(this.settings.mode){case "multiple":if(this.isSelected(a))return!1;
this._sel.push(a);break;case "range":1!==this._sel.length?this._sel=[a]:a.yearDay()>this._sel[0].yearDay()?this._sel[1]=a:this._sel=[a,this._sel[0]];break;default:this._sel=[a]}this._sel.sort(function(a,b){return a.yearDay()-b.yearDay()});this.publish("change",this,[a]);!1!==b&&this.draw();return!0},weekSelected:function(a){var b=a.toDate(),c=l(b).startOf("week"),b=l(b).endOf("week").subtract("day",1);this._sel=[c,b];this.publish("change",this,[a.day()]);this.draw()},makeSelectedDateVisible:function(a){outOfViewMonth=
l(a).date("1").diff(this.viewStartDate,"months");0>outOfViewMonth?this.viewStartDate.subtract("months",1):0<outOfViewMonth&&outOfViewMonth>=this.settings.months&&this.viewStartDate.add("months",1)},removeSelected:function(a,b){a=l(a,this.settings.format).hours(12);for(var c=this._sel.length;c--;)if(this._sel[c].yearDay()===a.yearDay())return this._sel.splice(c,1),this.publish("change",this,[a]),!1!==b&&this.draw(),!0;return!1},draw:function(){var a=l(this.viewStartDate).startOf("day").hours(12),b,
c=this.classes,n,e,f,h=0,p,q=0,t,u,m=this.settings;p=this.calendars.length;do{b=l(a).date(1);b.day(b.day()<this.settings.weekStart?this.settings.weekStart-7:this.settings.weekStart);n=this.calendars[h];n.caption.innerHTML=a.format(this.settings.titleFormat);t=q=0;do"week"==m.mode?(0===q%7&&0!==q&&t++,e=n.days[t].childNodes[q%7]):e=n.days[q],f=[],(u=this.isSelected(b))&&f.push({"-1":c.dayInRange,1:c.daySelected,"true":c.daySelected}[u]),b.month()!=a.month()?f.push(c.dayOutOfMonth):f.push(c.dayInMonth),
(!(this.blackout(b)||this.direction(b)||b.month()!=a.month()&&!1===m.dayOutOfMonthClickable)||0<u)&&f.push(c.dayActive),b.yearDay()===v.yearDay()&&f.push(c.dayToday),u=b.format(this.settings.dayAttributeFormat),m.dateClassMap[u]&&f.push(m.dateClassMap[u]),e.innerHTML=b.format(m.dayNumberFormat),e.className=f.join(" "),e.setAttribute("data-date",u),b.add("days",1);while(42>++q);a.add("months",1)}while(++h<p);if(m.directionScrolling){b=l().startOf("day").hours(12);a=a.diff(b,"months",!0);if("today-past"===
m.direction||"past"===m.direction)0>=a?(this.disableNextMonth=!1,d.removeClassName(this.container,c.disableNextMonth)):(this.disableNextMonth=!0,d.addClassName(this.container,c.disableNextMonth));else if("today-future"===m.direction||"future"===m.direction)a>m.months?(this.disablePreviousMonth=!1,d.removeClassName(this.container,c.disablePreviousMonth)):(this.disablePreviousMonth=!0,d.addClassName(this.container,c.disablePreviousMonth));if("today-past"===m.direction||"past"===m.direction)-11>=a?(this.disableNextYear=
!1,d.removeClassName(this.container,c.disableNextYear)):(this.disableNextYear=!0,d.addClassName(this.container,c.disableNextYear));else if("today-future"===m.direction||"future"===m.direction)a>11+m.months?(this.disablePreviousYear=!1,d.removeClassName(this.container,c.disablePreviousYear)):(this.disablePreviousYear=!0,d.addClassName(this.container,c.disablePreviousYear))}}};var D=function(a,b,c){var n=[];"string"===typeof a?a=a.split(b):d.isArray(a)||(a=[a]);b=a.length;var e=0;do a[e]&&n.push(l(a[e],
c).hours(12));while(++e<b);return n};window.Kalendae=p;var d=p.util={isIE8:function(){return!(!/msie 8./i.test(navigator.appVersion)||/opera/i.test(navigator.userAgent)||!window.ActiveXObject||!XDomainRequest||window.msPerformance)},$:function(a){return"string"==typeof a?document.getElementById(a):a},$$:function(a){return document.querySelectorAll(a)},make:function(a,b,c){var d;a=document.createElement(a);if(b)for(d in b)b.hasOwnProperty(d)&&a.setAttribute(d,b[d]);c&&c.appendChild(a);return a},isVisible:function(a){return 0<
a.offsetWidth||0<a.offsetHeight},getStyle:function(a,b){var c;a.currentStyle?c=a.currentStyle[b]:window.getComputedStyle&&(c=(c=window.getComputedStyle(a,null))?c[b]:"");return c},domReady:function(a){var b=document.readyState;"complete"===b||"interactive"===b?a():setTimeout(function(){d.domReady(a)},9)},addEvent:function(a,b,c){var d=function(b){b=b||window.event;var d=c.apply(a,[b,b.target||b.srcElement]);!1===d&&(b.preventDefault?b.preventDefault():(b.returnValue=!1,b.cancelBubble=!0));return d};
a.attachEvent?a.attachEvent("on"+b,d):a.addEventListener(b,d,!1);return d},removeEvent:function(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener(b,c,!1)},hasClassName:function(a,b){if(!(a=d.$(a)))return!1;var c=a.className;return 0<c.length&&(c==b||RegExp("(^|\\s)"+b+"(\\s|$)").test(c))},addClassName:function(a,b){(a=d.$(a))&&!d.hasClassName(a,b)&&(a.className+=(a.className?" ":"")+b)},removeClassName:function(a,b){if(a=d.$(a))a.className=d.trimString(a.className.replace(RegExp("(^|\\s+)"+
b+"(\\s+|$)")," "))},isFixed:function(a){do if("fixed"===d.getStyle(a,"position"))return!0;while(a=a.offsetParent);return!1},scrollContainer:function(a){do{var b=d.getStyle(a,"overflow");if("auto"===b||"scroll"===b)return a}while((a=a.parentNode)&&a!=window.document.body);return null},getPosition:function(a,b){var c=a.offsetLeft,d=a.offsetTop,e={};if(!b)for(;a=a.offsetParent;)c+=a.offsetLeft,d+=a.offsetTop;e[0]=e.left=c;e[1]=e.top=d;return e},getHeight:function(a){return a.offsetHeight||a.scrollHeight},
getWidth:function(a){return a.offsetWidth||a.scrollWidth},trimString:function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},merge:function(){for(var a=!0===arguments[0],b={},c=a?1:0;c<arguments.length;c++){var d=b,e=arguments[c];if("object"===typeof e){var f=void 0;for(f in e)e.hasOwnProperty(f)&&(a&&"object"===typeof d[f]&&"object"===typeof e[f]?_update(d[f],e[f]):d[f]=e[f])}}return b},isArray:function(a){return"[object Array]"==Object.prototype.toString.call(a)}};"function"===typeof document.addEventListener&&
p.util.domReady(function(){for(var a=d.$$(".auto-kal"),b=a.length,c,n;b--;)c=a[b],n=c.getAttribute("data-kal"),n=null==n||""==n?{}:(new Function("return {"+n+"};"))(),"INPUT"===c.tagName?new p.Input(c,n):new p(d.merge(n,{attachTo:c}))});p.Input=function(a,b){if("function"===typeof document.addEventListener||d.isIE8()){var c=this.input=d.$(a),n,e,f=!1;if(!c||"INPUT"!==c.tagName)throw"First argument for Kalendae.Input must be an <input> element or a valid element id.";var h=this,l=h.classes;e=h.settings=
d.merge(h.defaults,b);this._events={};e.attachTo=window.document.body;e.selected?n=!0:e.selected=c.value;p.call(h,e);e.closeButton&&(e=d.make("a",{"class":l.closeButton},h.container),d.addEvent(e,"click",function(){c.blur()}));n&&(c.value=h.getSelected());n=h.container;var q=!1;n.style.display="none";d.addClassName(n,l.positioned);this._events.containerMouseDown=d.addEvent(n,"mousedown",function(a,c){q=!0});this._events.documentMousedown=d.addEvent(window.document,"mousedown",function(a,c){q=!1});
this._events.inputFocus=d.addEvent(c,"focus",function(){f=!0;h.setSelected(this.value);f=!1;h.show()});this._events.inputBlur=d.addEvent(c,"blur",function(){q&&d.isIE8()?(q=!1,c.focus()):h.hide()});this._events.inputKeyup=d.addEvent(c,"keyup",function(a){f=!0;h.setSelected(this.value);f=!1});(l=d.scrollContainer(c))&&d.addEvent(l,"scroll",function(a){c.blur()});h.subscribe("change",function(){f||(c.value=h.getSelected())})}};p.Input.prototype=d.merge(p.prototype,{defaults:d.merge(p.prototype.defaults,
{format:"MM/DD/YYYY",side:"bottom",closeButton:!0,offsetLeft:0,offsetTop:0}),classes:d.merge(p.prototype.classes,{positioned:"k-floating",closeButton:"k-btn-close"}),show:function(){var a=this.container,b=a.style,c=this.input,n=d.getPosition(c),e=d.scrollContainer(c),e=e?e.scrollTop:0,f=this.settings;b.display="";switch(f.side){case "left":b.left=n.left-d.getWidth(a)+f.offsetLeft+"px";b.top=n.top+f.offsetTop-e+"px";break;case "right":b.left=n.left+d.getWidth(c)+"px";b.top=n.top+f.offsetTop-e+"px";
break;case "top":b.left=n.left+f.offsetLeft+"px";b.top=n.top-d.getHeight(a)+f.offsetTop-e+"px";break;default:b.left=n.left+f.offsetLeft+"px",b.top=n.top+d.getHeight(c)+f.offsetTop-e+"px"}b.position=d.isFixed(c)?"fixed":"absolute";this.publish("show",this)},hide:function(){this.container.style.display="none";this.publish("hide",this)},destroy:function(){var a=this.input;d.removeEvent(this.container,"mousedown",this._events.containerMousedown);d.removeEvent(window.document,"mousedown",this._events.documentMousedown);
d.removeEvent(a,"focus",this._events.inputFocus);d.removeEvent(a,"blur",this._events.inputBlur);d.removeEvent(a,"keyup",this._events.inputKeyup)}});var E=function(a){a||(a=this);var b=a.c_||{};a.publish=function(a,d,e){for(var f=(a=b[a])?a.length:0,h;f--;)if(h=a[f].apply(d,e||[]),"boolean"===typeof h)return h};a.subscribe=function(a,d,e){b[a]||(b[a]=[]);e?b[a].push(d):b[a].unshift(d);return[a,d]};a.unsubscribe=function(a){var d=b[a[0]];a=a[1];for(var e=d?d.length:0;e--;)d[e]===a&&d.splice(e,1)}};
(function(a){function b(g,a){return function(z){return q(g.call(this,z),a)}}function c(g){return function(a){return this.lang().ordinal(g.call(this,a))}}function d(){}function e(g){h(this,g)}function f(g){var a=this._data={},z=g.years||g.year||g.y||0,b=g.months||g.month||g.M||0,c=g.weeks||g.week||g.w||0,d=g.days||g.day||g.d||0,e=g.hours||g.hour||g.h||0,f=g.minutes||g.minute||g.m||0,h=g.seconds||g.second||g.s||0;g=g.milliseconds||g.millisecond||g.ms||0;this._milliseconds=g+1E3*h+6E4*f+36E5*e;this._days=
d+7*c;this._months=b+12*z;a.milliseconds=g%1E3;h+=l(g/1E3);a.seconds=h%60;f+=l(h/60);a.minutes=f%60;e+=l(f/60);a.hours=e%24;d+=l(e/24);d+=7*c;a.days=d%30;b+=l(d/30);a.months=b%12;z+=l(b/12);a.years=z}function h(g,a){for(var b in a)a.hasOwnProperty(b)&&(g[b]=a[b]);return g}function l(g){return 0>g?Math.ceil(g):Math.floor(g)}function q(g,a){for(var b=g+"";b.length<a;)b="0"+b;return b}function p(g,a,b){var c=a._milliseconds,d=a._days;a=a._months;c&&g._d.setTime(+g+c*b);d&&g.date(g.date()+d*b);a&&(c=
g.date(),g.date(1).month(g.month()+a*b).date(Math.min(c,g.daysInMonth())))}function u(g,a){var b=Math.min(g.length,a.length),c=Math.abs(g.length-a.length),d=0,e;for(e=0;e<b;e++)~~g[e]!==~~a[e]&&d++;return d+c}function m(g){if(!g)return k.fn._lang;!A[g]&&S&&require("./lang/"+g);return A[g]}function r(g){var a=g.match(K),b,c;b=0;for(c=a.length;b<c;b++)a[b]=w[a[b]]?w[a[b]]:a[b].match(/\[.*\]/)?a[b].replace(/^\[|\]$/g,""):a[b].replace(/\\/g,"");return function(d){var e="";for(b=0;b<c;b++)e+="function"===
typeof a[b].call?a[b].call(d,g):a[b];return e}}function v(g,a){function b(a){return g.lang().longDateFormat(a)||a}for(var c=5;c--&&L.test(a);)a=a.replace(L,b);F[a]||(F[a]=r(a));return F[a](g)}function D(g){switch(g){case "DDDD":return T;case "YYYY":return U;case "YYYYY":return V;case "S":case "SS":case "SSS":case "DDD":return W;case "MMM":case "MMMM":case "dd":case "ddd":case "dddd":case "a":case "A":return X;case "X":return Y;case "Z":case "ZZ":return M;case "T":return Z;case "MM":case "DD":case "YY":case "HH":case "hh":case "mm":case "ss":case "M":case "D":case "d":case "H":case "h":case "m":case "s":return aa;
default:return RegExp(g.replace("\\",""))}}function C(g){var a,b=[];if(!g._d){for(a=0;7>a;a++)g._a[a]=b[a]=null==g._a[a]?2===a?1:0:g._a[a];b[3]+=g._tzh||0;b[4]+=g._tzm||0;a=new Date(0);g._useUTC?(a.setUTCFullYear(b[0],b[1],b[2]),a.setUTCHours(b[3],b[4],b[5],b[6])):(a.setFullYear(b[0],b[1],b[2]),a.setHours(b[3],b[4],b[5],b[6]));g._d=a}}function y(a){var b=a._f.match(K),c=a._i,d,e;a._a=[];for(d=0;d<b.length;d++)if((e=(D(b[d]).exec(c)||[])[0])&&(c=c.slice(c.indexOf(e)+e.length)),w[b[d]]){var f=a,h=void 0,
k=f._a;switch(b[d]){case "M":case "MM":k[1]=null==e?0:~~e-1;break;case "MMM":case "MMMM":h=m(f._l).monthsParse(e);null!=h?k[1]=h:f._isValid=!1;break;case "D":case "DD":case "DDD":case "DDDD":null!=e&&(k[2]=~~e);break;case "YY":k[0]=~~e+(68<~~e?1900:2E3);break;case "YYYY":case "YYYYY":k[0]=~~e;break;case "a":case "A":f._isPm="pm"===(e+"").toLowerCase();break;case "H":case "HH":case "h":case "hh":k[3]=~~e;break;case "m":case "mm":k[4]=~~e;break;case "s":case "ss":k[5]=~~e;break;case "S":case "SS":case "SSS":k[6]=
~~(1E3*("0."+e));break;case "X":f._d=new Date(1E3*parseFloat(e));break;case "Z":case "ZZ":f._useUTC=!0,(h=(e+"").match(ba))&&h[1]&&(f._tzh=~~h[1]),h&&h[2]&&(f._tzm=~~h[2]),h&&"+"===h[0]&&(f._tzh=-f._tzh,f._tzm=-f._tzm)}null==e&&(f._isValid=!1)}a._isPm&&12>a._a[3]&&(a._a[3]+=12);!1===a._isPm&&12===a._a[3]&&(a._a[3]=0);C(a)}function E(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function I(a,b,c){b=c-b;c-=a.day();c>b&&(c-=7);c<b-7&&(c+=7);return Math.ceil(k(a).add("d",c).dayOfYear()/7)}function J(g){var b=
g._i,c=g._f;if(null===b||""===b)return null;"string"===typeof b&&(g._i=b=m().preparse(b));if(k.isMoment(b))g=h({},b),g._d=new Date(+b._d);else if(c)if("[object Array]"===Object.prototype.toString.call(c)){for(var b=g,d,f,l=99;b._f.length;){d=h({},b);d._f=b._f.pop();y(d);c=new e(d);if(c.isValid()){f=c;break}d=u(d._a,c.toArray());d<l&&(l=d,f=c)}h(b,f)}else y(g);else if(f=g,b=f._i,c=ca.exec(b),b===a)f._d=new Date;else if(c)f._d=new Date(+c[1]);else if("string"===typeof b)if(c=f._i,da.exec(c)){f._f="YYYY-MM-DDT";
for(b=0;4>b;b++)if(N[b][1].exec(c)){f._f+=N[b][0];break}M.exec(c)&&(f._f+=" Z");y(f)}else f._d=new Date(c);else"[object Array]"===Object.prototype.toString.call(b)?(f._a=b.slice(0),C(f)):f._d=b instanceof Date?new Date(+b):new Date(b);return new e(g)}function O(a,b){k.fn[a]=k.fn[a+"s"]=function(a){var g=this._isUTC?"UTC":"";return null!=a?(this._d["set"+g+b](a),this):this._d["get"+g+b]()}}function ea(a){k.duration.fn[a]=function(){return this._data[a]}}function P(a,b){k.duration.fn["as"+a]=function(){return+this/
b}}for(var k,x=Math.round,s,A={},S="undefined"!==typeof module&&module.exports,ca=/^\/?Date\((\-?\d+)/i,K=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,L=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,aa=/\d\d?/,W=/\d{1,3}/,T=/\d{3}/,U=/\d{1,4}/,V=/[+\-]?\d{1,6}/,X=/[0-9]*[a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF]+\s*?[\u0600-\u06FF]+/i,M=/Z|[\+\-]\d\d:?\d\d/i,Z=/T/i,Y=/[\+\-]?\d+(\.\d{1,3})?/,
da=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,N=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],ba=/([\+\-]|\d\d)/gi,G="Month Date Hours Minutes Seconds Milliseconds".split(" "),H={Milliseconds:1,Seconds:1E3,Minutes:6E4,Hours:36E5,Days:864E5,Months:2592E6,Years:31536E6},F={},Q="DDD w W M D d".split(" "),R="MDHhmswW".split(""),w={M:function(){return this.month()+1},MMM:function(a){return this.lang().monthsShort(this,
a)},MMMM:function(a){return this.lang().months(this,a)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(a){return this.lang().weekdaysMin(this,a)},ddd:function(a){return this.lang().weekdaysShort(this,a)},dddd:function(a){return this.lang().weekdays(this,a)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return q(this.year()%100,2)},YYYY:function(){return q(this.year(),4)},YYYYY:function(){return q(this.year(),
5)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return q(~~(this.milliseconds()/10),2)},SSS:function(){return q(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";0>a&&(a=-a,b="-");
return b+q(~~(a/60),2)+":"+q(~~a%60,2)},ZZ:function(){var a=-this.zone(),b="+";0>a&&(a=-a,b="-");return b+q(~~(10*a/6),4)},X:function(){return this.unix()}};Q.length;)s=Q.pop(),w[s+"o"]=c(w[s]);for(;R.length;)s=R.pop(),w[s+s]=b(w[s],2);w.DDDD=b(w.DDD,3);d.prototype={set:function(a){var b,c;for(c in a)b=a[c],"function"===typeof b?this[c]=b:this["_"+c]=b},_months:"January February March April May June July August September October November December".split(" "),months:function(a){return this._months[a.month()]},
_monthsShort:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),monthsShort:function(a){return this._monthsShort[a.month()]},monthsParse:function(a){var b,c;this._monthsParse||(this._monthsParse=[]);for(b=0;12>b;b++)if(this._monthsParse[b]||(c=k([2E3,b]),c="^"+this.months(c,"")+"|^"+this.monthsShort(c,""),this._monthsParse[b]=RegExp(c.replace(".",""),"i")),this._monthsParse[b].test(a))return b},_weekdays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),weekdays:function(a){return this._weekdays[a.day()]},
_weekdaysShort:"Sun Mon Tue Wed Thu Fri Sat".split(" "),weekdaysShort:function(a){return this._weekdaysShort[a.day()]},_weekdaysMin:"Su Mo Tu We Th Fr Sa".split(" "),weekdaysMin:function(a){return this._weekdaysMin[a.day()]},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(a){var b=this._longDateFormat[a];!b&&this._longDateFormat[a.toUpperCase()]&&(b=this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,
function(a){return a.slice(1)}),this._longDateFormat[a]=b);return b},meridiem:function(a,b,c){return 11<a?c?"pm":"PM":c?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},calendar:function(a,b){var c=this._calendar[a];return"function"===typeof c?c.apply(b):c},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",
dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(a,b,c,d){var e=this._relativeTime[c];return"function"===typeof e?e(a,b,c,d):e.replace(/%d/i,a)},pastFuture:function(a,b){var c=this._relativeTime[0<a?"future":"past"];return"function"===typeof c?c(b):c.replace(/%s/i,b)},ordinal:function(a){return this._ordinal.replace("%d",a)},_ordinal:"%d",preparse:function(a){return a},postformat:function(a){return a},week:function(a){return I(a,this._week.dow,this._week.doy)},
_week:{dow:0,doy:6}};k=function(a,b,c){return J({_i:a,_f:b,_l:c,_isUTC:!1})};k.utc=function(a,b,c){return J({_useUTC:!0,_isUTC:!0,_l:c,_i:a,_f:b})};k.unix=function(a){return k(1E3*a)};k.duration=function(a,b){var c=k.isDuration(a),d="number"===typeof a,e=c?a._data:d?{}:a;d&&(b?e[b]=a:e.milliseconds=a);d=new f(e);c&&a.hasOwnProperty("_lang")&&(d._lang=a._lang);return d};k.version="2.0.0";k.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";k.lang=function(a,b){if(!a)return k.fn._lang._abbr;b?(b.abbr=a,A[a]||(A[a]=
new d),A[a].set(b)):A[a]||m(a);k.duration.fn._lang=k.fn._lang=m(a)};k.langData=function(a){a&&(a._lang&&a._lang._abbr)&&(a=a._lang._abbr);return m(a)};k.isMoment=function(a){return a instanceof e};k.isDuration=function(a){return a instanceof f};k.fn=e.prototype={clone:function(){return k(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1E3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._d},toJSON:function(){return k.utc(this).format("YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},
toArray:function(){return[this.year(),this.month(),this.date(),this.hours(),this.minutes(),this.seconds(),this.milliseconds()]},isValid:function(){null==this._isValid&&(this._isValid=this._a?!u(this._a,(this._isUTC?k.utc(this._a):k(this._a)).toArray()):!isNaN(this._d.getTime()));return!!this._isValid},utc:function(){this._isUTC=!0;return this},local:function(){this._isUTC=!1;return this},format:function(a){a=v(this,a||k.defaultFormat);return this.lang().postformat(a)},add:function(a,b){var c;c="string"===
typeof a?k.duration(+b,a):k.duration(a,b);p(this,c,1);return this},subtract:function(a,b){var c;c="string"===typeof a?k.duration(+b,a):k.duration(a,b);p(this,c,-1);return this},diff:function(a,b,c){a=this._isUTC?k(a).utc():k(a).local();var d=6E4*(this.zone()-a.zone()),e;b&&(b=b.replace(/s$/,""));"year"===b||"month"===b?(d=432E5*(this.daysInMonth()+a.daysInMonth()),e=12*(this.year()-a.year())+(this.month()-a.month()),e+=(this-k(this).startOf("month")-(a-k(a).startOf("month")))/d,"year"===b&&(e/=12)):
(d=this-a-d,e="second"===b?d/1E3:"minute"===b?d/6E4:"hour"===b?d/36E5:"day"===b?d/864E5:"week"===b?d/6048E5:d);return c?e:l(e)},from:function(a,b){return k.duration(this.diff(a)).lang(this.lang()._abbr).humanize(!b)},fromNow:function(a){return this.from(k(),a)},calendar:function(){var a=this.diff(k().startOf("day"),"days",!0),a=-6>a?"sameElse":-1>a?"lastWeek":0>a?"lastDay":1>a?"sameDay":2>a?"nextDay":7>a?"nextWeek":"sameElse";return this.format(this.lang().calendar(a,this))},isLeapYear:function(){var a=
this.year();return 0===a%4&&0!==a%100||0===a%400},isDST:function(){return this.zone()<k([this.year()]).zone()||this.zone()<k([this.year(),5]).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null==a?b:this.add({d:a-b})},startOf:function(a){a=a.replace(/s$/,"");switch(a){case "year":this.month(0);case "month":this.date(1);case "week":case "day":this.hours(0);case "hour":this.minutes(0);case "minute":this.seconds(0);case "second":this.milliseconds(0)}"week"===a&&
this.day(0);return this},endOf:function(a){return this.startOf(a).add(a.replace(/s?$/,"s"),1).subtract("ms",1)},isAfter:function(a,b){b="undefined"!==typeof b?b:"millisecond";return+this.clone().startOf(b)>+k(a).startOf(b)},isBefore:function(a,b){b="undefined"!==typeof b?b:"millisecond";return+this.clone().startOf(b)<+k(a).startOf(b)},isSame:function(a,b){b="undefined"!==typeof b?b:"millisecond";return+this.clone().startOf(b)===+k(a).startOf(b)},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},
daysInMonth:function(){return k.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(a){var b=x((k(this).startOf("day")-k(this).startOf("year"))/864E5)+1;return null==a?b:this.add("d",a-b)},isoWeek:function(a){var b=I(this,1,4);return null==a?b:this.add("d",7*(a-b))},week:function(a){var b=this.lang().week(this);return null==a?b:this.add("d",7*(a-b))},lang:function(b){if(b===a)return this._lang;this._lang=m(b);return this}};for(s=0;s<G.length;s++)O(G[s].toLowerCase().replace(/s$/,""),G[s]);
O("year","FullYear");k.fn.days=k.fn.day;k.fn.weeks=k.fn.week;k.fn.isoWeeks=k.fn.isoWeek;k.duration.fn=f.prototype={weeks:function(){return l(this.days()/7)},valueOf:function(){return this._milliseconds+864E5*this._days+2592E6*this._months},humanize:function(a){var b=+this,c;c=!a;var d=this.lang(),e=x(Math.abs(b)/1E3),f=x(e/60),h=x(f/60),k=x(h/24),l=x(k/365),e=45>e&&["s",e]||1===f&&["m"]||45>f&&["mm",f]||1===h&&["h"]||22>h&&["hh",h]||1===k&&["d"]||25>=k&&["dd",k]||45>=k&&["M"]||345>k&&["MM",x(k/30)]||
1===l&&["y"]||["yy",l];e[2]=c;e[3]=0<b;e[4]=d;c=E.apply({},e);a&&(c=this.lang().pastFuture(b,c));return this.lang().postformat(c)},lang:k.fn.lang};for(s in H)H.hasOwnProperty(s)&&(P(s,H[s]),ea(s.toLowerCase()));P("Weeks",6048E5);k.lang("en",{ordinal:function(a){var b=a%10;return a+(1===~~(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th")}});this.moment=k}).call("undefined"===typeof p?window:p);if(!p.moment)if(window.moment)p.moment=window.moment;else throw"Kalendae requires moment.js. You must use kalendae.standalone.js if moment is not available on the page.";
l=p.moment;l.fn.stripTime=function(){this._d=new Date(864E5*Math.floor(this._d.valueOf()/864E5));return this};l.fn.yearDay=function(a){var b=Math.floor(this._d/864E5);return"undefined"===typeof a?b:this.add({d:a-b})};v=p.moment().stripTime();"undefined"===typeof jQuery||"function"!==typeof document.addEventListener&&!d.isIE8()||(jQuery.fn.kalendae=function(a){this.each(function(b,c){"INPUT"===c.tagName?$(c).data("kalendae",new p.Input(c,a)):$(c).data("kalendae",new p($.extend({},{attachTo:c},a)))});
return this})})();
